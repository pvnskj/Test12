<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Venkata Parimi | Senior Technical Product Owner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="Senior Technical Product Owner specializing in distributed systems, event-driven architectures, and cloud-native patterns">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    :root {
      --bg: #000000;
      --text: #ffffff;
      --gold: #FFD700;
      --gold-hot: #FFFACD;
      --glass-panel: rgba(5, 5, 5, 0.9);
      --border-dim: rgba(255, 255, 255, 0.15);
      --border-gold: rgba(255, 215, 0, 0.6);
      --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* --- 1. MOUSE FLASHLIGHT (Brighter) --- */
    #cursor-glow {
      position: fixed;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 215, 0, 0.15) 25%, rgba(0, 0, 0, 0) 70%);
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 5;
      mix-blend-mode: screen;
      transition: opacity 0.2s;
    }

    /* --- 2. LAYERS --- */
    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    #ui-layer {
      position: relative;
      width: 100vw;
      height: 100vh;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.6s var(--ease-out);
      opacity: 1;
      transform: scale(1);
    }

    body.expanded #ui-layer {
      opacity: 0;
      transform: scale(1.5);
      pointer-events: none;
    }

    /* --- 3. CENTER ORB --- */
    .orb-container {
      position: absolute;
      width: 50px;
      height: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      transition: transform 0.3s ease;
    }

    .orb-label {
      font-weight: 700;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      font-size: 1.2rem;
      color: #FFFFFF;
      text-shadow: 0 0 40px rgba(255, 255, 255, 0.8), 0 0 80px rgba(255, 215, 0, 0.5);
      text-align: center;
      margin-top: 5px;
      pointer-events: none;
    }

    .orb-container:hover {
      transform: scale(1.1);
    }

    /* --- 4. PROJECT NODES --- */
    .node {
      position: absolute;
      width: 90px;
      height: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 15;
    }

    .node-bg {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid var(--border-dim);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
      transition: all 0.3s ease;
      z-index: 1;
    }

    .node-icon-img {
      width: 38px;
      height: 38px;
      object-fit: contain;
      position: relative;
      z-index: 2;
      transition: transform 0.3s ease;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.9));
    }

    .node-title {
      position: absolute;
      top: 70px;
      width: 120px;
      text-align: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.5);
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      z-index: 3;
    }

    .node:hover {
      z-index: 50;
    }

    .node:hover .node-bg {
      width: 70px;
      height: 70px;
      border-color: var(--gold);
      background: rgba(20, 20, 20, 0.95);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.25);
    }

    .node:hover .node-icon-img {
      transform: scale(1.2);
    }

    .node:hover .node-title {
      color: white;
      transform: translateY(3px);
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    /* --- 5. EXPANDED HERO DASHBOARD (WHITE THEME) --- */
    .hero-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.5s ease;
      background: rgba(0, 0, 0, 0.6);
      /* Dim background */
    }

    body.expanded .hero-overlay {
      opacity: 1;
      pointer-events: all;
    }

    .hero-card {
      width: 900px;
      height: 600px;
      max-height: 90vh;
      max-width: 95vw;
      background: #ffffff;
      color: #1a1a1a;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-top: 4px solid var(--gold);
      border-radius: 12px;
      box-shadow: 0 20px 80px rgba(0, 0, 0, 0.5);
      display: grid;
      grid-template-columns: 300px 1fr;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.6s var(--ease-out);
    }

    body.expanded .hero-card {
      transform: scale(1);
    }

    .hero-sidebar {
      background: #f8fafc;
      border-right: 1px solid #e2e8f0;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .hero-icon {
      width: 100px;
      height: 100px;
      margin-bottom: 20px;
      filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.2));
    }

    .hero-pill {
      color: #d4af37;
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.1em;
      margin-bottom: 10px;
    }

    .hero-title {
      font-size: 1.8rem;
      line-height: 1.1;
      margin-bottom: 30px;
      font-weight: 300;
    }

    .hero-title b {
      font-weight: 800;
      color: #0f172a;
    }

    .hero-stats {
      width: 100%;
      margin-top: auto;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      padding: 15px 0;
    }

    .stat-row:last-child {
      border-bottom: none;
    }

    .s-val {
      font-weight: 700;
      color: #d4af37;
      font-size: 1.2rem;
    }

    .s-lbl {
      color: #888;
      font-size: 0.7rem;
      text-transform: uppercase;
    }

    .hero-content {
      padding: 0;
      display: flex;
      flex-direction: column;
    }

    .hero-header {
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      border-bottom: 1px solid #e2e8f0;
    }

    .tab-group {
      display: flex;
      gap: 30px;
      height: 100%;
    }

    .hero-tab {
      background: transparent;
      border: none;
      height: 100%;
      color: #666;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.85rem;
      cursor: pointer;
      position: relative;
      transition: color 0.3s;
    }

    .hero-tab::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--gold);
      transform: scaleX(0);
      transition: transform 0.3s;
    }

    .hero-tab.active {
      color: #0f172a;
    }

    .hero-tab.active::after {
      transform: scaleX(1);
    }

    .close-hero {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #666;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-hero:hover {
      color: #000;
    }

    .tab-pane {
      padding: 40px;
      display: none;
      flex: 1;
      flex-direction: column;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }

    .tab-pane.active {
      display: flex;
      opacity: 1;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pane-desc {
      font-size: 1.1rem;
      line-height: 1.7;
      color: #475569;
      margin-bottom: 30px;
      flex: 1;
    }

    .action-area {
      margin-top: auto;
    }

    .primary-btn {
      width: 100%;
      padding: 18px;
      background: var(--gold);
      color: black;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
      transition: all 0.2s;
    }

    .primary-btn:hover {
      background: #ffe033;
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
    }

    .doc-viewer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 200;
      background: #000;
      transform: translateY(100%);
      transition: transform 0.5s ease;
      display: flex;
      flex-direction: column;
    }

    .doc-viewer.open {
      transform: translateY(0);
    }

    .doc-nav {
      height: 60px;
      background: #0a0a0a;
      border-bottom: 1px solid #222;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
    }

    .doc-close {
      color: var(--gold);
      cursor: pointer;
      text-transform: uppercase;
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    iframe {
      flex: 1;
      border: none;
      background: white;
    }

    @media (max-width: 800px) {
      .hero-card {
        grid-template-columns: 1fr;
        width: 100%;
        height: 100%;
        border-radius: 0;
        border: none;
        overflow-y: auto;
      }

      .hero-sidebar {
        padding: 20px;
        flex-direction: row;
        text-align: left;
        gap: 20px;
      }

      .hero-icon {
        width: 60px;
        height: 60px;
        margin: 0;
      }

      .hero-stats {
        display: none;
      }
    }
  </style>
</head>

<body>

  <div id="cursor-glow"></div>
  <div id="canvas-container"></div>

  <div id="ui-layer">
    <button class="primary-btn" id="center-orb" onclick="expandProject('profile')"
      style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: auto; height: auto; padding: 12px 24px; z-index: 50; box-shadow: 0 0 40px rgba(255, 215, 0, 0.4); text-transform: uppercase; letter-spacing: 0.1em; font-size: 1rem;">
      Venkata Parimi
    </button>
    <div id="nodes-container"></div>
  </div>

  <div class="hero-overlay" id="hero-overlay">
    <div class="hero-card">
      <div class="hero-sidebar">
        <img src="" id="h-icon" class="hero-icon">
        <div style="flex:1">
          <div class="hero-pill" id="h-pill">Category</div>
          <div class="hero-title" id="h-title">Project Title</div>
        </div>
        <div class="hero-stats" id="h-stats"></div>
      </div>

      <div class="hero-content">
        <div class="hero-header">
          <div class="tab-group">
            <button class="hero-tab active" onclick="switchHeroTab('impact')" id="tab-impact">Business
              Impact</button>
            <button class="hero-tab" onclick="switchHeroTab('white')" id="tab-white">Tech
              Whitepaper</button>
          </div>
          <button class="close-hero" onclick="closeHero()">✕</button>
        </div>

        <div class="tab-pane active" id="pane-impact">
          <div class="pane-desc" id="desc-impact"></div>
          <div class="action-area">
            <button class="primary-btn" id="btn-impact" onclick="openDocCurrent('impact')">View Impact
              Deck</button>
          </div>
        </div>

        <div class="tab-pane" id="pane-white">
          <div class="pane-desc" id="desc-white"></div>
          <div class="action-area">
            <button class="primary-btn" style="background:transparent; border:1px solid var(--gold); color:var(--gold)"
              id="btn-white" onclick="openDocCurrent('white')">Read Whitepaper</button>
          </div>
        </div>

      </div>

    </div>
  </div>

  <div class="doc-viewer" id="doc-viewer">
    <div class="doc-nav">
      <div style="color:white; font-weight:600">Document Viewer</div>
      <div class="doc-close" onclick="closeDoc()">Close ✕</div>
    </div>
    <iframe id="doc-frame" src=""></iframe>
  </div>

  <script>
    // --- 1. DATA ---
    const iconUrl = (name) => `https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/${name}.png`;

    const rfdsTowerIcon = "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Tokyo%20Tower.png";
    const p2pCashIcon = "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Money%20Bag.png";

    const data = {
      profile: {
        type: "profile", pill: "Profile", title: "Senior <b>Technical Product Owner</b>",
        descImpact: "I bridge the gap between business strategy and engineering reality. With over 10 years of experience, I specialize in building resilient, scalable systems by translating ambiguity into architectural blueprints and shipped software. My focus is on reducing technical debt while maximizing business velocity.",
        descWhite: "My technical foundation lies in distributed systems, event-driven architectures, and cloud-native patterns. I advocate for Domain-Driven Design (DDD) to align software complexity with business needs. Click below to view my detailed CV and technical competency matrix.",
        stats: [{ val: "10+", label: "Years Exp" }, { val: "9", label: "Core Systems" }],
        links: { impact: "mailto:me@example.com", white: "#" },
        btnLabels: { impact: "Email Me", white: "LinkedIn Profile" }
      },
      projects: [
        {
          id: "asset", icon: iconUrl("Objects/Books"), label: "Asset Catalog", pill: "Data Gov", title: "Enterprise <b>Asset Catalog</b>",
          descImpact: "Established a Single Source of Truth for enterprise assets across Procurement, Warehouse, and Finance systems. This unified definition eliminated data silos, reducing duplicate asset purchasing by 38% in the first quarter and ensuring 100% data integrity for financial auditing.",
          descWhite: "Implemented using a Graph Database (Neo4j) to map asset relationships and dependencies. The architecture utilizes an Event-Sourcing pattern to maintain a full audit trail of asset lifecycle changes, ensuring strictly typed data contracts between microservices.",
          stats: [{ val: "100%", label: "Data Integrity" }, { val: "38%", label: "Less Duplicates" }],
          links: { impact: "asset-catalog-impact.html", white: "asset-catalog-whitepaper.html" }
        },
        {
          id: "inventory", icon: iconUrl("Objects/Package"), label: "Inventory", pill: "Supply Chain", title: "Promise <b>Engine</b>",
          descImpact: "Built a real-time availability engine utilizing demand signals and replenishment orchestration. This system prevents overselling on e-commerce channels while optimizing stock levels in local distribution centers, resulting in a 12% lift in On-Time-In-Full (OTIF) deliveries.",
          descWhite: "Architected as a high-throughput distributed system using Kafka for stream processing. The 'Promise Engine' calculates availability snapshots in sub-50ms latency using Redis caching layers and asynchronous write-behind strategies to the core ERP.",
          stats: [{ val: "12%", label: "OTIF Lift" }, { val: "0%", label: "Stockouts" }],
          links: { impact: "inventory-impact.html", white: "inventory-whitepaper.html" }
        },
        {
          id: "inspection", icon: iconUrl("Objects/Magnifying%20Glass%20Tilted%20Left"), label: "Inspection", pill: "Operations", title: "Digital <b>Inspection</b>",
          descImpact: "Deployed a mobile-first inspection framework with intelligent routing, digital ledgers, and automated alerts. This replaced manual paper trails, reducing issue escalation time by 4x and creating immediate, audit-ready evidence trails for compliance.",
          descWhite: "Developed as a Progressive Web App (PWA) with offline-first capabilities using IndexedDB. Sync conflicts are resolved using CRDTs (Conflict-Free Replicated Data Types) to ensure data consistency when field agents reconnect to the network.",
          stats: [{ val: "4x", label: "Faster Resolve" }, { val: "100%", label: "Audit Ready" }],
          links: { impact: "inspection-impact.html", white: "inspection-whitepaper.html" }
        },
        {
          id: "order", icon: iconUrl("Travel%20and%20places/Delivery%20Truck"), label: "Fulfillment", pill: "Logistics", title: "Order <b>Fulfillment</b>",
          descImpact: "Created a commitment engine blending catalog integrity with real-time inventory signals. The system ensures that what is promised to the customer during checkout is exactly what is shipped, reducing broken promises to near zero.",
          descWhite: "Utilizes a Saga Pattern for distributed transactions across Order, Payment, and Inventory services. This ensures atomic consistency without tight coupling, allowing for graceful degradation and automated compensation logic during failures.",
          stats: [{ val: "22%", label: "Cycle Speed" }, { val: "99.9%", label: "Accuracy" }],
          links: { impact: "order-fulfillment-impact.html", white: "order-fulfillment-whitepaper.html" }
        },
        {
          id: "rfds", icon: rfdsTowerIcon, label: "RFDS", pill: "Engineering", title: "Automated <b>RFDS</b>",
          descImpact: "Responsive RFDS program with live guardrails. Illustrates how field data sheet requests trigger automated validations, lineage capture, and downstream workflow routing. Achieved 100% automated routing for approvals, saving countless engineering hours per site deployment.",
          descWhite: "Built on a Python-based generation engine that ingests structured engineering data to render PDF/CAD schematics programmatically. The system integrates with existing PLM tools via REST APIs to fetch component specifications dynamically.",
          stats: [{ val: "100%", label: "Auto Routed" }, { val: "Hrs", label: "Saved/Site" }],
          links: { impact: "RFDS-impact.html", white: "RFDS.html" }
        },
        {
          id: "gl", icon: iconUrl("Objects/Coin"), label: "GL Coding", pill: "Finance", title: "Auto <b>GL Coding</b>",
          descImpact: "Designed a policy-driven engine that automatically codes invoices to the correct General Ledger (GL) accounts. Replaces rigid, hard-coded financial logic with a flexible, rules-based engine capable of generating precise accounting codes for any project type.",
          descWhite: "Implemented a Rule Engine utilizing a decision tree structure stored in JSON configuration. This allows Finance teams to update coding logic via a UI without requiring code deployments. The system processes invoices via a message queue for scalability.",
          stats: [{ val: "4 Day", label: "Faster Close" }, { val: "99%", label: "Accuracy" }],
          links: { impact: "gl-coding-impact.html", white: "Gl Coding Whitepaper.html" }
        },
        {
          id: "risk", icon: iconUrl("Objects/Chart%20Increasing"), label: "Risk", pill: "Analysis", title: "Risk <b>Telemetry</b>",
          descImpact: "Developed lifecycle-aware asset and portfolio controls. The system monitors valuation changes and liquidity triggers in real-time, sending automated alerts to risk managers to prevent exposure beyond defined thresholds.",
          descWhite: "Leverages a time-series database (InfluxDB) to ingest high-frequency market data. Complex Event Processing (CEP) rules run in real-time to detect anomalies and trigger webhooks for immediate remediation workflows.",
          stats: [{ val: "Real", label: "Time Calc" }, { val: "Auto", label: "Alerts" }],
          links: { impact: "financial-projections-impact.html", white: "financial-projections-whitepaper.html" }
        },
        {
          id: "p2p", icon: p2pCashIcon, label: "P2P", pill: "Payments", title: "Trusted <b>P2P</b>",
          descImpact: "Architected ledger-backed peer-to-peer transaction flows with built-in dispute playbooks and interoperability rules. This increased user trust and significantly reduced fraud-related reversals.",
          descWhite: "Secured using double-entry ledger patterns within a relational database to ensure zero-sum consistency. Identity verification integration provides non-repudiation for high-value transfers.",
          stats: [{ val: "Low", label: "Fraud Rate" }, { val: "High", label: "Trust Score" }],
          links: { impact: "peer-to-peer-transactions-impact.html", white: "peer-to-peer-transactions-whitepaper.html" }
        }
      ]
    };

    // --- 2. LAYOUT ---
    const nodesContainer = document.getElementById('nodes-container');
    let radius = window.innerWidth < 768 ? 140 : 220;

    function initLayout() {
      nodesContainer.innerHTML = '';
      const count = data.projects.length;
      const step = (2 * Math.PI) / count;

      data.projects.forEach((p, i) => {
        const angle = i * step - Math.PI / 2;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;

        const el = document.createElement('div');
        el.className = 'node';
        el.id = `node-${p.id}`;
        el.style.left = `calc(50% + ${x}px - 45px)`;
        el.style.top = `calc(50% + ${y}px - 45px)`;
        el.innerHTML = `
          <div class="node-bg"></div>
          <img src="${p.icon}" class="node-icon-img" alt="">
          <div class="node-title">${p.label}</div>
        `;
        el.onclick = () => expandProject(p.id);
        nodesContainer.appendChild(el);
      });
    }

    // --- 3. EXPANSION LOGIC ---
    let currentId = null;

    function expandProject(id) {
      currentId = id;
      const item = id === 'profile' ? data.profile : data.projects.find(x => x.id === id);

      document.getElementById('h-icon').src =
        item.type === 'profile'
          ? "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Star-Struck.png"
          : item.icon;

      document.getElementById('h-pill').innerText = item.pill;
      document.getElementById('h-title').innerHTML = item.title;

      document.getElementById('h-stats').innerHTML = item.stats.map(s => `
        <div class="stat-row"><span class="s-val">${s.val}</span><span class="s-lbl">${s.label}</span></div>
      `).join('');

      document.getElementById('desc-impact').innerText = item.descImpact;
      document.getElementById('desc-white').innerText = item.descWhite;

      if (item.type === 'profile') {
        document.getElementById('btn-impact').innerText = item.btnLabels.impact;
        document.getElementById('btn-white').innerText = item.btnLabels.white;
      } else {
        document.getElementById('btn-impact').innerText = "View Impact Deck";
        document.getElementById('btn-white').innerText = "Read Whitepaper";
      }

      document.body.classList.add('expanded');
      switchHeroTab('impact');
    }

    function closeHero() {
      document.body.classList.remove('expanded');
    }

    function switchHeroTab(tab) {
      document.querySelectorAll('.hero-tab').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));

      document.getElementById(`tab-${tab}`).classList.add('active');
      document.getElementById(`pane-${tab}`).classList.add('active');
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === "Escape") {
        closeDoc();
        closeHero();
      }
    });

    // --- 4. DOC VIEWER ---
    function openDocCurrent(type) {
      const item = currentId === 'profile' ? data.profile : data.projects.find(x => x.id === currentId);
      const url = item.links[type];

      if (item.type === 'profile') {
        window.location.href = url;
      } else {
        document.getElementById('doc-frame').src = url;
        document.getElementById('doc-viewer').classList.add('open');
      }
    }

    function closeDoc() {
      document.getElementById('doc-viewer').classList.remove('open');
      setTimeout(() => document.getElementById('doc-frame').src = "", 500);
    }

    // --- 5. MOUSE GLOW ---
    const glow = document.getElementById('cursor-glow');
    document.addEventListener('mousemove', (e) => {
      requestAnimationFrame(() => {
        glow.style.left = e.clientX + 'px';
        glow.style.top = e.clientY + 'px';
      });
    }, { passive: true });

    // --- 6. THREE.JS MERGED (MAGIC ORB + MOUSE ENERGY + FIREFLIES) ---
    function initThree() {
      const container = document.getElementById('canvas-container');
      container.innerHTML = "";

      const scene = new THREE.Scene();
      scene.fog = new THREE.Fog(0x000000, 50, 200);

      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 400);
      camera.position.set(0, 0, 65);

      const renderer = new THREE.WebGLRenderer({
        alpha: true,
        antialias: true,
        powerPreference: "high-performance"
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x000000, 0);
      renderer.outputEncoding = THREE.sRGBEncoding;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.15;
      container.appendChild(renderer.domElement);

      // Mouse energy tracking (for particle influence)
      const mouse = new THREE.Vector3(0, 0, 0);
      window.addEventListener('mousemove', (e) => {
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
      }, { passive: true });

      // Ambient lighting
      const ambient = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambient);

      // ===== PARTICLE TEXTURE (SOFT GLOW) =====
      function makeGlowTex() {
        const c = document.createElement('canvas');
        c.width = c.height = 64;
        const ctx = c.getContext('2d');
        const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
        g.addColorStop(0.0, 'rgba(255,255,255,1)');
        g.addColorStop(0.25, 'rgba(255,215,0,0.9)');
        g.addColorStop(0.6, 'rgba(255,215,0,0.25)');
        g.addColorStop(1.0, 'rgba(0,0,0,0)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, 64, 64);
        const t = new THREE.Texture(c);
        t.needsUpdate = true;
        return t;
      }

      const glowTex = makeGlowTex();

      // ===== MAGIC ORB GROUP =====
      const orb = new THREE.Group();
      scene.add(orb);

      // 1) Dense particle core (replaces solid mesh)
      const innerCoreCount = 3500;
      const innerCoreGeo = new THREE.BufferGeometry();
      const innerCorePos = new Float32Array(innerCoreCount * 3);
      const innerCoreVel = new Float32Array(innerCoreCount * 3);
      const innerCorePhase = new Float32Array(innerCoreCount);

      for (let i = 0; i < innerCoreCount; i++) {
        const r = Math.random() * 1.9 // Reduced from 4.5 for smaller orb
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(2 * Math.random() - 1);

        const x = r * Math.sin(phi) * Math.cos(theta);
        const y = r * Math.sin(phi) * Math.sin(theta);
        const z = r * Math.cos(phi);

        innerCorePos.set([x, y, z], i * 3);

        // Swirl velocity
        innerCoreVel.set([
          -y * 0.09,
          x * 0.09,
          (Math.random() - 0.5) * 0.01
        ], i * 3);

        innerCorePhase[i] = Math.random() * Math.PI * 2;
      }

      innerCoreGeo.setAttribute('position', new THREE.BufferAttribute(innerCorePos, 3));
      innerCoreGeo.setAttribute('velocity', new THREE.BufferAttribute(innerCoreVel, 3));
      innerCoreGeo.setAttribute('aPhase', new THREE.BufferAttribute(innerCorePhase, 1));

      const innerCoreMat = new THREE.PointsMaterial({
        size: 0.2, // Reduced from 0.45
        map: glowTex,
        transparent: true,
        opacity: 1.0,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        color: 0xFFFFFF // Bright white/gold particles
      });

      const innerCore = new THREE.Points(innerCoreGeo, innerCoreMat);
      orb.add(innerCore);

      // 2) Energy shell with shader (fresnel + animated turbulence)
      const shellMat = new THREE.ShaderMaterial({
        transparent: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        uniforms: {
          uTime: { value: 0.0 },
          uIntensity: { value: 1.2 }
        },
        vertexShader: `
          varying vec3 vN;
          varying vec3 vWPos;
          void main() {
            vN = normalize(normalMatrix * normal);
            vec4 wp = modelMatrix * vec4(position, 1.0);
            vWPos = wp.xyz;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float uTime;
          uniform float uIntensity;
          varying vec3 vN;
          varying vec3 vWPos;

          float hash(vec3 p) {
            p = fract(p * 0.3183099 + vec3(0.1,0.2,0.3));
            p *= 17.0;
            return fract(p.x * p.y * p.z * (p.x + p.y + p.z));
          }

          float noise(vec3 p){
            vec3 i = floor(p);
            vec3 f = fract(p);
            f = f*f*(3.0 - 2.0*f);
            float n000 = hash(i + vec3(0,0,0));
            float n100 = hash(i + vec3(1,0,0));
            float n010 = hash(i + vec3(0,1,0));
            float n110 = hash(i + vec3(1,1,0));
            float n001 = hash(i + vec3(0,0,1));
            float n101 = hash(i + vec3(1,0,1));
            float n011 = hash(i + vec3(0,1,1));
            float n111 = hash(i + vec3(1,1,1));
            float n00 = mix(n000, n100, f.x);
            float n10 = mix(n010, n110, f.x);
            float n01 = mix(n001, n101, f.x);
            float n11 = mix(n011, n111, f.x);
            float n0 = mix(n00, n10, f.y);
            float n1 = mix(n01, n11, f.y);
            return mix(n0, n1, f.z);
          }

          void main() {
            float fres = pow(1.0 - abs(vN.z), 2.8);
            float t = uTime * 0.7;
            vec3 p = vWPos * 0.25 + vec3(t, -t*0.8, t*0.4);
            float n = noise(p) * 0.7 + noise(p * 2.5) * 0.3;
            float bands = sin((vWPos.y * 0.6) + (uTime * 1.5) + n * 2.2);
            bands = smoothstep(-0.2, 0.9, bands);

            vec3 colA = vec3(1.00, 0.98, 0.88);
            vec3 colB = vec3(1.00, 0.80, 0.20);
            vec3 col = mix(colB, colA, fres);

            float alpha = (fres * 0.92 + bands * 0.38) * (0.6 + n * 0.7) * uIntensity;
            alpha *= smoothstep(0.02, 0.2, alpha);

            if(alpha < 0.03) discard;
            gl_FragColor = vec4(col, alpha);
          }
        `
      });
      const shell = new THREE.Mesh(new THREE.SphereGeometry(5.0, 96, 96), shellMat);
      orb.add(shell);

      // 3) Outer halo (soft glow)
      const haloMat = new THREE.MeshBasicMaterial({
        color: 0xffd36a,
        transparent: true,
        opacity: 0.15,
        blending: THREE.AdditiveBlending,
        depthWrite: false
      });
      const halo = new THREE.Mesh(new THREE.SphereGeometry(1.8, 32, 32), haloMat);
      orb.add(halo);

      // ===== ENERGY ORB CORE PARTICLES (from first script, with mouse influence) =====
      const coreCount = 2000;
      const coreGeo = new THREE.BufferGeometry();
      const corePos = new Float32Array(coreCount * 3);
      const coreVel = new Float32Array(coreCount * 3);

      for (let i = 0; i < coreCount; i++) {
        const r = 4.2 + Math.random() * 1.8; // Reduced from 6 + 2.5
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(2 * Math.random() - 1);

        const x = r * Math.sin(phi) * Math.cos(theta);
        const y = r * Math.sin(phi) * Math.sin(theta);
        const z = r * Math.cos(phi);

        corePos.set([x, y, z], i * 3);

        // Tangential velocity (creates swirl)
        coreVel.set([
          -y * 0.002,
          x * 0.002,
          (Math.random() - 0.5) * 0.002
        ], i * 3);
      }

      coreGeo.setAttribute('position', new THREE.BufferAttribute(corePos, 3));
      coreGeo.setAttribute('velocity', new THREE.BufferAttribute(coreVel, 3));

      const coreParticlesMat = new THREE.PointsMaterial({
        size: 0.01, // Reduced from 0.5
        map: glowTex,
        transparent: true,
        opacity: 0.85,
        depthWrite: false,
        blending: THREE.AdditiveBlending
      });

      const coreParticles = new THREE.Points(coreGeo, coreParticlesMat);
      orb.add(coreParticles);

      // ===== FIREFLY FIELD (from first script, with mouse influence + flow field) =====
      const flyCount = 92000;
      const flyGeo = new THREE.BufferGeometry();
      const flyPos = new Float32Array(flyCount * 3);
      const flyVel = new Float32Array(flyCount * 3);

      for (let i = 0; i < flyCount; i++) {
        const radius = 18 + Math.random() * 90;
        const a = Math.random() * Math.PI * 2;
        const b = Math.acos(2 * Math.random() - 1);

        flyPos.set([
          radius * Math.sin(b) * Math.cos(a),
          radius * Math.sin(b) * Math.sin(a),
          radius * Math.cos(b)
        ], i * 3);

        flyVel.set([
          (Math.random() - 0.5) * 0.015,
          (Math.random() - 0.5) * 0.015,
          (Math.random() - 0.5) * 0.015
        ], i * 3);
      }

      flyGeo.setAttribute('position', new THREE.BufferAttribute(flyPos, 3));
      flyGeo.setAttribute('velocity', new THREE.BufferAttribute(flyVel, 3));

      const flyMat = new THREE.PointsMaterial({
        size: 0.25,
        map: glowTex,
        transparent: true,
        opacity: 0.65,
        depthWrite: false,
        blending: THREE.AdditiveBlending
      });

      const fireflies = new THREE.Points(flyGeo, flyMat);
      scene.add(fireflies);

      // ===== BACKGROUND STAR FIELD =====
      const starCount = window.innerWidth < 768 ? 1200 : 1800;
      const starGeo = new THREE.BufferGeometry();
      const starPos = new Float32Array(starCount * 3);
      const starCol = new Float32Array(starCount * 3);
      const starSize = new Float32Array(starCount);

      for (let i = 0; i < starCount; i++) {
        const z = -30 - Math.pow(Math.random(), 1.9) * 200;
        const spread = 1.0 + (-z / 220);

        starPos[i * 3 + 0] = (Math.random() - 0.5) * 220 * spread;
        starPos[i * 3 + 1] = (Math.random() - 0.5) * 140 * spread;
        starPos[i * 3 + 2] = z;

        const w = 0.70 + Math.random() * 0.25;
        starCol[i * 3 + 0] = 1.0;
        starCol[i * 3 + 1] = w;
        starCol[i * 3 + 2] = 0.12 + Math.random() * 0.14;

        starSize[i] = 0.08 + Math.pow(Math.random(), 2.8) * 0.3;
      }

      starGeo.setAttribute("position", new THREE.BufferAttribute(starPos, 3));
      starGeo.setAttribute("color", new THREE.BufferAttribute(starCol, 3));
      starGeo.setAttribute("aSize", new THREE.BufferAttribute(starSize, 1));

      function makeSpriteTex() {
        const c = document.createElement("canvas");
        c.width = 64; c.height = 64;
        const ctx = c.getContext("2d");
        const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
        g.addColorStop(0.00, "rgba(255,255,255,1)");
        g.addColorStop(0.18, "rgba(255,224,140,0.95)");
        g.addColorStop(0.45, "rgba(255,215,0,0.35)");
        g.addColorStop(1.00, "rgba(0,0,0,0)");
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, 64, 64);
        const t = new THREE.Texture(c);
        t.needsUpdate = true;
        return t;
      }
      const spriteTex = makeSpriteTex();

      const starsMat = new THREE.ShaderMaterial({
        transparent: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        uniforms: { uTex: { value: spriteTex }, uPR: { value: Math.min(window.devicePixelRatio, 2) } },
        vertexShader: `
          uniform float uPR;
          attribute float aSize;
          varying vec3 vColor;
          void main() {
            vColor = color;
            vec4 mv = modelViewMatrix * vec4(position, 1.0);
            float dist = -mv.z;
            float ps = aSize * uPR * (120.0 / max(dist, 30.0));
            gl_PointSize = clamp(ps, 1.0, 5.0);
            gl_Position = projectionMatrix * mv;
          }
        `,
        fragmentShader: `
          uniform sampler2D uTex;
          varying vec3 vColor;
          void main() {
            vec4 tex = texture2D(uTex, gl_PointCoord);
            float a = tex.a * 0.5;
            if(a < 0.02) discard;
            gl_FragColor = vec4(vColor, a);
          }
        `
      });

      const stars = new THREE.Points(starGeo, starsMat);
      scene.add(stars);

      // ===== ANIMATION LOOP (MERGED FEATURES) =====
      const clock = new THREE.Clock();

      function animate() {
        requestAnimationFrame(animate);
        const t = clock.getElapsedTime();

        // Magic orb rotation and breathing
        orb.rotation.y = t * 0.25;
        orb.rotation.x = Math.sin(t * 0.4) * 0.08;

        // Inner particle core rotation
        innerCore.rotation.y += 0.004;
        innerCore.rotation.x += 0.003;
        const breath = 1.0 + Math.sin(t * 1.4) * 0.035;
        innerCore.scale.set(breath, breath, breath);

        shell.material.uniforms.uTime.value = t;
        halo.material.opacity = 0.12 + 0.05 * (0.5 + 0.5 * Math.sin(t * 1.1));

        // Core particles swirl
        coreParticles.rotation.y += 0.003;
        coreParticles.rotation.x += 0.002;

        // Firefly motion with flow field + mouse influence
        const p = flyGeo.attributes.position.array;
        const v = flyGeo.attributes.velocity.array;

        for (let i = 0; i < flyCount; i++) {
          const ix = i * 3;

          // 1. Curl noise / Float forces
          // A gentle, continuous, time-varying field
          const cx = Math.sin(p[ix + 1] * 0.01 + t * 0.4) * 0.002;
          const cy = Math.cos(p[ix] * 0.01 + t * 0.4) * 0.002;
          const cz = Math.sin(p[ix] * 0.01 + p[ix + 1] * 0.01 + t * 0.3) * 0.002;

          v[ix] += cx;
          v[ix + 1] += cy;
          v[ix + 2] += cz;

          // 2. Mouse influence
          v[ix] += mouse.x * 0.001;
          v[ix + 1] += mouse.y * 0.001;

          // 3. Soft Containment forces (Pull back gently if too far)
          const d2 = p[ix] * p[ix] + p[ix + 1] * p[ix + 1] + p[ix + 2] * p[ix + 2];
          const maxDistSq = 14400; // 120^2

          if (d2 > maxDistSq) {
            const dist = Math.sqrt(d2);
            const force = (dist - 120) * 0.0001;
            // Apply force towards center
            v[ix] -= (p[ix] / dist) * force;
            v[ix + 1] -= (p[ix + 1] / dist) * force;
            v[ix + 2] -= (p[ix + 2] / dist) * force;
          }

          // 4. Friction (Stabilizes motion)
          v[ix] *= 0.98;
          v[ix + 1] *= 0.98;
          v[ix + 2] *= 0.98;

          // 5. Update Position
          p[ix] += v[ix];
          p[ix + 1] += v[ix + 1];
          p[ix + 2] += v[ix + 2];
        }

        flyGeo.attributes.position.needsUpdate = true;

        // Stars slow drift
        stars.rotation.y = t * 0.012;

        renderer.render(scene, camera);
      }

      animate();

      // Resize handler
      window.addEventListener('resize', () => {
        radius = window.innerWidth < 768 ? 140 : 220;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        starsMat.uniforms.uPR.value = Math.min(window.devicePixelRatio, 2);

        initLayout();
      }, { passive: true });
    }

    window.onload = () => { initLayout(); initThree(); };
  </script>
</body>

</html>
